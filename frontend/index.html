<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Wangenye Wangenye Bookstore</title>
<meta name="description" content="Wangenye Wangenye Online Bookstore — browse featured books, search, sign-in, and add to cart (demo)." />
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>📚</text></svg>">
<style>
  :root{
    --bg:#f6f6f8;
    --card:#ffffff;
    --muted:#6b7280;
    --accent:#7b3fe4;
    --accent-2:#ff7a59;
    --glass: rgba(255,255,255,0.6);
    color-scheme: light;
    --radius:12px;
    --shadow: 0 8px 24px rgba(16,24,40,0.06);
  }
  [data-theme="dark"]{
    --bg:#0b1020;
    --card:#0f1724;
    --muted:#9aa4b2;
    --accent:#8b5cf6;
    --accent-2:#ff9671;
    --glass: rgba(255,255,255,0.03);
    color-scheme: dark;
    --shadow: 0 10px 30px rgba(2,6,23,0.7);
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background:linear-gradient(180deg,var(--bg),rgba(0,0,0,0.02));
    color:var(--muted);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    line-height:1.4;
    padding:0 16px;
  }

  header{
    max-width:1100px;
    margin:20px auto;
    display:flex;
    align-items:center;
    gap:16px;
    justify-content:space-between;
  }
  .brand{
    display:flex;
    gap:12px;
    align-items:center;
  }
  .logo{
    width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent-2));
    display:flex;align-items:center;justify-content:center;color:white;font-weight:700;box-shadow:var(--shadow);
    transform:translateY(-2px);
  }
  h1.site-title{
    font-size:18px;margin:0;color:var(--accent-2);font-weight:700;
  }
  nav ul{list-style:none;padding:0;margin:0;display:flex;gap:12px;align-items:center}
  nav a{
    text-decoration:none;padding:8px 10px;border-radius:8px;color:var(--muted);font-weight:600;
  }
  nav a:hover, nav a:focus{background:var(--glass);color:inherit;outline:none}

  .controls{display:flex;gap:8px;align-items:center}
  .btn{
    background:linear-gradient(90deg,var(--accent),var(--accent-2));
    color:#fff;padding:8px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:700;box-shadow:var(--shadow);
  }
  .ghost{
    background:transparent;border:1px solid rgba(0,0,0,0.06);color:var(--muted);padding:8px 10px;border-radius:10px;cursor:pointer;
  }

  main{
    max-width:1100px;margin:26px auto 80px;
  }

  .hero{
    display:grid;grid-template-columns:1fr 360px;gap:20px;align-items:center;margin-bottom:22px;
  }
  .hero-card{
    background:var(--card);border-radius:var(--radius);padding:28px;box-shadow:var(--shadow);overflow:hidden;
  }
  .hero h2{margin:0 0 8px 0;font-size:22px;color:var(--accent-2)}
  .hero p{margin:0;color:var(--muted);font-size:15px}
  .search-row{display:flex;gap:10px;margin-top:18px;align-items:center}
  .search{
    flex:1;display:flex;gap:8px;align-items:center;background:var(--glass);padding:8px;border-radius:10px;border:1px solid rgba(0,0,0,0.03);
  }
  .search input{border:0;background:transparent;outline:none;font-size:15px;width:100%}
  .toggle{display:inline-flex;align-items:center;gap:8px}

  .stats{
    background:linear-gradient(180deg,rgba(123,63,228,0.08),transparent);
    border-radius:10px;padding:12px;margin-top:14px;display:flex;gap:10px;align-items:center;
  }
  .stat{font-weight:700;color:var(--accent);font-size:16px}

  /* Books grid */
  .section-title{display:flex;align-items:center;justify-content:space-between;gap:12px;margin:18px 0}
  .books-grid{
    display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:18px;
  }
  .book-card{
    background:var(--card);border-radius:12px;padding:12px;box-shadow:var(--shadow);overflow:hidden;display:flex;flex-direction:column;gap:12px;
    transform:translateY(20px);opacity:0;transition:transform .6s cubic-bezier(.2,.9,.25,1), opacity .6s;
  }
  .book-card.in-view{transform:none;opacity:1}
  .cover{
    height:160px;border-radius:8px;background:linear-gradient(180deg,rgba(0,0,0,0.06),transparent);
    display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--muted);font-size:18px;
    overflow:hidden;
  }
  .book-info{display:flex;flex-direction:column;gap:6px}
  .book-info h3{margin:0;font-size:16px;color:var(--accent);display:flex;justify-content:space-between;align-items:center;gap:8px}
  .muted{color:var(--muted);font-size:13px}
  .price{font-weight:800;color:var(--accent-2)}
  .book-actions{display:flex;gap:8px;margin-top:auto}

  .pill{display:inline-flex;gap:8px;align-items:center;padding:6px 8px;border-radius:999px;background:var(--glass);font-weight:700}

  /* Footer */
  footer{max-width:1100px;margin:30px auto 60px;text-align:center;color:var(--muted)}
  .socials{display:flex;gap:10px;justify-content:center;margin-top:8px}

  /* Modals */
  .modal-backdrop{
    position:fixed;inset:0;background:rgba(2,6,23,0.45);display:none;align-items:center;justify-content:center;z-index:60;
  }
  .modal{
    width:100%;max-width:720px;background:var(--card);border-radius:14px;padding:18px;box-shadow:var(--shadow);
  }
  .modal.open{display:block}
  .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .form-row{display:flex;flex-direction:column;gap:6px}
  label{font-size:13px;color:var(--muted)}

  /* cart badge */
  .cart-btn{position:relative}
  .badge{
    position:absolute;top:-6px;right:-6px;background:var(--accent-2);color:white;padding:4px 7px;border-radius:999px;font-size:12px;font-weight:800;
  }

  /* small screens */
  @media (max-width:880px){
    .hero{grid-template-columns:1fr;gap:12px}
    .logo{width:44px;height:44px}
  }

  /* subtle hover */
  .book-card:hover{transform:translateY(-6px);box-shadow:0 18px 40px rgba(0,0,0,0.12)}
  .book-card .cover img{width:100%;height:100%;object-fit:cover;display:block}

  /* small utility */
  .muted-2{color:var(--muted)}
  input,button,textarea{font-family:inherit}
  .link-like{background:transparent;border:0;color:var(--accent);cursor:pointer;font-weight:700}
</style>
</head>
<body>

<header role="banner" aria-label="Global header">
  <div class="brand" style="gap:14px">
    <div class="logo" aria-hidden="true">WW</div>
    <div>
      <div class="site-title">Wangenye Wangenye Bookstore</div>
      <div style="font-size:12px;color:var(--muted)">Books, stories & more — demo</div>
    </div>
  </div>

  <nav aria-label="Primary">
    <ul>
      <li><a href="#home">Home</a></li>
      <li><a href="#books">Books</a></li>
      <li><a href="#contact">Contact</a></li>
    </ul>
  </nav>

  <div class="controls">
    <button class="ghost" id="themeToggle" aria-pressed="false" title="Toggle dark mode">🌓</button>
    <button class="ghost" id="authBtn">Sign in</button>
    <button class="btn cart-btn" id="openCart" aria-label="Open cart">
      🛒 <span id="cartCount" class="badge" style="display:none">0</span>
    </button>
  </div>
</header>

<main id="home">
  <section class="hero-card hero" aria-labelledby="hero-heading">
    <div>
      <h2 id="hero-heading">Discover your next great read</h2>
      <p>Handpicked fiction, non-fiction, and local favorites — browse, search, and save to cart. This page is a single-file demo with interactive UI and cart powered by browser storage.</p>

      <div class="search-row" style="margin-top:12px">
        <div class="search" role="search" aria-label="Search books">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" d="M21 21l-4.35-4.35"/><circle cx="11" cy="11" r="6" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <input id="searchInput" type="search" placeholder="Search by title or author..." aria-label="Search books" />
        </div>

        <div class="toggle pill" aria-hidden="true">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" d="M12 3v2M12 19v2M4.2 4.2l1.4 1.4M18.4 18.4l1.4 1.4M1 12h2M21 12h2M4.2 19.8l1.4-1.4M18.4 5.6l1.4-1.4"/></svg>
          <span id="themeLabel">Light</span>
        </div>
      </div>

      <div class="stats" aria-hidden="true">
        <div>📚 <span class="stat" id="booksCount">0</span> books</div>
        <div style="flex:1"></div>
        <div class="muted">Demo: cart & auth stored locally</div>
      </div>
    </div>
    <aside style="display:flex;flex-direction:column;gap:12px">
      <div style="background:linear-gradient(180deg,var(--accent),var(--accent-2));border-radius:12px;padding:16px;color:white;box-shadow:var(--shadow)">
        <div style="font-weight:800;font-size:18px">Featured</div>
        <div style="margin-top:8px">Curated selection — free demo checkout (no payment).</div>
        <div style="margin-top:12px;display:flex;gap:8px;">
          <button class="btn" onclick="document.querySelector('#books').scrollIntoView({behavior:'smooth'})">Browse Books</button>
          <button class="ghost" id="openSignup">Create account</button>
        </div>
      </div>

      <div style="background:var(--card);padding:12px;border-radius:12px;box-shadow:var(--shadow)">
        <div style="font-weight:800">New Arrivals</div>
        <ul style="padding-left:16px;margin:10px 0;color:var(--muted)">
          <li>Forest of Stories — 2025</li>
          <li>Modern Nairobi Tales — 2024</li>
          <li>Design Thinking for Everyone — 2023</li>
        </ul>
      </div>
    </aside>
  </section>

  <section id="books" aria-labelledby="books-heading">
    <div class="section-title">
      <h2 id="books-heading">Featured Books</h2>
      <div class="muted">Showing <span id="visibleCount">0</span> results</div>
    </div>

    <div class="books-grid" id="booksGrid" aria-live="polite">
      <!-- Book cards appended by JS -->
    </div>
  </section>

  <section id="contact" style="margin-top:28px">
    <div class="hero-card">
      <h3>Contact</h3>
      <p class="muted">Email: <a href="mailto:hello@example.com">hello@example.com</a> — for demo purposes only.</p>
      <form id="contactForm" style="margin-top:12px;display:grid;gap:10px;max-width:700px">
        <div style="display:flex;gap:8px">
          <input name="name" placeholder="Your name" required style="flex:1;padding:10px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)">
          <input name="email" type="email" placeholder="Email" required style="flex:1;padding:10px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)">
        </div>
        <textarea name="message" placeholder="Message" required rows="4" style="padding:10px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)"></textarea>
        <div><button class="btn" type="submit">Send message</button></div>
      </form>
    </div>
  </section>
</main>

<footer>
  <div style="max-width:1100px;margin:0 auto">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
      <div style="font-weight:700">© <span id="copyYear"></span> Wangenye Wangenye</div>
      <div class="socials" role="navigation" aria-label="Social">
        <a class="ghost" href="#" aria-label="Twitter">🐦</a>
        <a class="ghost" href="#" aria-label="Instagram">📸</a>
        <a class="ghost" href="#" aria-label="Facebook">📘</a>
      </div>
    </div>
    <div style="margin-top:10px;color:var(--muted);font-size:13px">Built as a single-file demo. To make it production-ready you'll need backend APIs for auth, orders and payment processing.</div>
  </div>
</footer>

<!-- Modals -->
<div id="modalBackdrop" class="modal-backdrop" aria-hidden="true" role="dialog" aria-modal="true">
  <div class="modal" role="document" id="modalContent">
    <!-- content replaced by JS -->
  </div>
</div>

<!-- Book & Cart templates are injected by JS -->
<script>
/*
  Single-file bookstore demo
  - Books are stored in `books` array (mock data)
  - Cart & users use localStorage (demo only — not secure)
  - Animations done via CSS + IntersectionObserver
*/

/* ----- Mock books data ----- */
const books = [
  {id:'b1',title:'Forest of Stories',author:'A. Njoroge',price:12.99,cover:'',desc:'A lyrical collection of short stories exploring village life.'},
  {id:'b2',title:'Modern Nairobi Tales',author:'K. Mwangi',price:15.50,cover:'',desc:'Urban stories about love, loss and coffee in Nairobi.'},
  {id:'b3',title:'Design Thinking for Everyone',author:'S. Patel',price:22.00,cover:'',desc:'Practical design strategies for non-designers.'},
  {id:'b4',title:'Cookbook: Home Flavors',author:'J. Wanjiru',price:18.00,cover:'',desc:'Easy recipes that bring comfort and joy.'},
  {id:'b5',title:'The Quiet River',author:'L. Omondi',price:14.25,cover:'',desc:'A coming-of-age novel set along a Kenyan river.'},
  {id:'b6',title:'Business Basics',author:'E. Kimani',price:19.99,cover:'',desc:'Entrepreneurship lessons and case studies.'}
];

/* small placeholders for covers */
books.forEach((b,i)=>b.cover = `data:image/svg+xml;utf8,${encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='600' height='900'><rect width='100%' height='100%' fill='${i%2? '#f3e8ff':'#fff7ed'}'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-family='Arial' font-size='36' fill='#111'>${b.title.replace(/&/g,'&amp;')}</text></svg>`)}`);

/* ----- State helpers: cart and auth via localStorage ----- */
const CART_KEY = 'ww_cart_v1';
const USERS_KEY = 'ww_users_v1';
const SESSION_KEY = 'ww_session_v1';

function saveCart(cart){ localStorage.setItem(CART_KEY, JSON.stringify(cart)); updateCartUI(); }
function loadCart(){ return JSON.parse(localStorage.getItem(CART_KEY) || '[]'); }
function saveUsers(users){ localStorage.setItem(USERS_KEY, JSON.stringify(users)); }
function loadUsers(){ return JSON.parse(localStorage.getItem(USERS_KEY) || '[]'); }
function setSession(user){ localStorage.setItem(SESSION_KEY, JSON.stringify(user)); updateAuthUI(); }
function getSession(){ return JSON.parse(localStorage.getItem(SESSION_KEY) || 'null'); }
function clearSession(){ localStorage.removeItem(SESSION_KEY); updateAuthUI(); }

/* ----- UI rendering ----- */
const booksGrid = document.getElementById('booksGrid');
const booksCount = document.getElementById('booksCount');
const visibleCount = document.getElementById('visibleCount');
const copyYear = document.getElementById('copyYear');
const cartCountEl = document.getElementById('cartCount');

copyYear.textContent = new Date().getFullYear();

function renderBooks(list){
  booksGrid.innerHTML='';
  list.forEach(b=>{
    const card = document.createElement('article');
    card.className='book-card';
    card.tabIndex = 0;
    card.innerHTML = `
      <div class="cover" aria-hidden="true"><img loading="lazy" src="${b.cover}" alt="${escapeHtml(b.title)} cover"></div>
      <div class="book-info">
        <h3>${escapeHtml(b.title)} <span style="font-size:13px;color:var(--muted)">${escapeHtml(b.author)}</span></h3>
        <div class="muted">${truncate(b.desc,80)}</div>
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div class="price">$${b.price.toFixed(2)}</div>
          <div class="book-actions">
            <button class="ghost" data-action="details" data-id="${b.id}">Details</button>
            <button class="btn" data-action="add" data-id="${b.id}">Add</button>
          </div>
        </div>
      </div>
    `;
    booksGrid.appendChild(card);
  });
  booksCount.textContent = list.length;
  visibleCount.textContent = list.length;
  observeCards();
}

/* ----- helpers ----- */
function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
function truncate(s,n){ return s.length>n? s.slice(0,n-1)+'…': s }

/* ----- search/filter ----- */
const searchInput = document.getElementById('searchInput');
searchInput.addEventListener('input', ()=> {
  const q = searchInput.value.trim().toLowerCase();
  const filtered = books.filter(b => (b.title + ' ' + b.author + ' ' + b.desc).toLowerCase().includes(q));
  renderBooks(filtered);
  visibleCount.textContent = filtered.length;
});

/* ----- event delegation for book actions ----- */
booksGrid.addEventListener('click', (e)=>{
  const btn = e.target.closest('button');
  if(!btn) return;
  const action = btn.dataset.action;
  const id = btn.dataset.id;
  if(action === 'add') addToCart(id);
  if(action === 'details') openBookDetails(id);
});

/* keyboard accessibility for book cards (Enter opens details) */
booksGrid.addEventListener('keydown', (e)=>{
  if(e.key === 'Enter'){
    const card = e.target.closest('.book-card');
    if(card){
      const id = card.querySelector('[data-action]').dataset.id;
      openBookDetails(id);
    }
  }
});

/* ----- Cart functions ----- */
function updateCartUI(){
  const cart = loadCart();
  const totalItems = cart.reduce((s,i)=>s+i.qty,0);
  if(totalItems>0){
    cartCountEl.style.display='inline-block'; cartCountEl.textContent = totalItems;
  } else {
    cartCountEl.style.display='none';
  }
}

function addToCart(id){
  const book = books.find(b=>b.id===id);
  if(!book) return;
  const cart = loadCart();
  const existing = cart.find(x=>x.id===id);
  if(existing) existing.qty++;
  else cart.push({id:book.id, title:book.title, price:book.price, qty:1});
  saveCart(cart);
  // visual feedback
  flashMessage(`Added "${book.title}" to cart`);
}

/* ----- Cart modal ----- */
const openCartBtn = document.getElementById('openCart');
openCartBtn.addEventListener('click', showCart);

function showCart(){
  const cart = loadCart();
  let total = cart.reduce((s,i)=>s+i.qty*i.price,0);
  const content = document.getElementById('modalContent');
  if(cart.length===0){
    content.innerHTML = `
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3>Cart</h3><button class="link-like" id="closeModal">Close</button>
      </div>
      <div style="padding:20px 0">Your cart is empty. Browse books and add items.</div>
      <div style="text-align:right"><button class="btn" id="closeModal2">Continue browsing</button></div>
    `;
    openModal();
    return;
  }
  content.innerHTML = `
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3>Cart (${cart.reduce((s,i)=>s+i.qty,0)} items)</h3>
      <button class="link-like" id="closeModal">Close</button>
    </div>
    <div style="max-height:360px;overflow:auto;padding:12px 0">
      ${cart.map(it=>`<div style="display:flex;gap:10px;align-items:center;padding:8px 0;border-bottom:1px solid rgba(0,0,0,0.04)">
        <div style="width:56px;height:56px;background:var(--glass);display:flex;align-items:center;justify-content:center;border-radius:8px">${it.title.slice(0,2)}</div>
        <div style="flex:1"><div style="font-weight:700">${escapeHtml(it.title)}</div><div class="muted-2">$${it.price.toFixed(2)} • Qty: ${it.qty}</div></div>
        <div style="display:flex;gap:8px">
          <button class="ghost" data-cart-action="dec" data-id="${it.id}">-</button>
          <button class="ghost" data-cart-action="inc" data-id="${it.id}">+</button>
          <button class="link-like" data-cart-action="remove" data-id="${it.id}">Remove</button>
        </div>
      </div>`).join('')}
    </div>
    <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
      <div style="font-weight:800">Total: $${total.toFixed(2)}</div>
      <div style="display:flex;gap:8px">
        <button class="ghost" id="clearCart">Clear</button>
        <button class="btn" id="checkoutBtn">Checkout</button>
      </div>
    </div>
  `;
  openModal();
}

/* cart actions inside modal */
document.getElementById('modalBackdrop').addEventListener('click', (e)=>{
  if(e.target.id === 'modalBackdrop') closeModal();
});

document.getElementById('modalContent').addEventListener('click', (e)=>{
  const btn = e.target.closest('button');
  if(!btn) return;
  if(btn.id === 'closeModal' || btn.id === 'closeModal2'){ closeModal(); return; }
  if(btn.id === 'clearCart'){ saveCart([]); flashMessage('Cart cleared'); closeModal(); return; }
  if(btn.id === 'checkoutBtn'){ handleCheckout(); return; }

  const action = btn.dataset.cartAction;
  const id = btn.dataset.id;
  if(action){
    const cart = loadCart();
    const idx = cart.findIndex(x=>x.id===id);
    if(idx===-1) return;
    if(action==='inc') cart[idx].qty++;
    if(action==='dec') { cart[idx].qty--; if(cart[idx].qty<=0) cart.splice(idx,1); }
    if(action==='remove') cart.splice(idx,1);
    saveCart(cart);
    showCart(); // re-render
  }
});

/* fake checkout: if user signed in, success; else ask to sign in */
function handleCheckout(){
  const user = getSession();
  if(!user){
    flashMessage('Please sign in to checkout', true);
    openAuth('signin');
    return;
  }
  // fake checkout: clear cart
  saveCart([]);
  closeModal();
  flashMessage(`Thanks ${user.name || user.email}! Your order has been placed (demo).`);
}

/* ----- Book details ----- */
function openBookDetails(id){
  const b = books.find(x=>x.id===id);
  const content = document.getElementById('modalContent');
  content.innerHTML = `
    <div style="display:flex;gap:12px;align-items:flex-start">
      <div style="width:45%;min-width:150px"><img src="${b.cover}" alt="${escapeHtml(b.title)} cover" style="width:100%;border-radius:8px"></div>
      <div style="flex:1">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <h3 style="margin:0">${escapeHtml(b.title)}</h3>
            <div class="muted" style="margin-top:6px">${escapeHtml(b.author)}</div>
          </div>
          <div style="font-weight:900;color:var(--accent-2)">$${b.price.toFixed(2)}</div>
        </div>
        <p style="margin-top:12px" class="muted">${escapeHtml(b.desc)}</p>
        <div style="margin-top:16px;display:flex;gap:8px">
          <button class="btn" id="addFromDetails" data-id="${b.id}">Add to cart</button>
          <button class="ghost" id="closeModal">Close</button>
        </div>
      </div>
    </div>
  `;
  openModal();
  document.getElementById('addFromDetails').addEventListener('click', (e)=>{ addToCart(e.target.dataset.id); });
}

/* ----- Modal open/close ----- */
const backdrop = document.getElementById('modalBackdrop');
function openModal(){ backdrop.style.display='flex'; backdrop.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden'; }
function closeModal(){ backdrop.style.display='none'; backdrop.setAttribute('aria-hidden','true'); document.body.style.overflow=''; }

/* ----- Auth UI (sign up / sign in) ----- */
const authBtn = document.getElementById('authBtn');
authBtn.addEventListener('click', ()=> openAuth('signin'));
document.getElementById('openSignup').addEventListener('click', ()=> openAuth('signup'));

function openAuth(mode='signin'){
  const content = document.getElementById('modalContent');
  content.innerHTML = `
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3>${mode==='signup'?'Create account':'Sign in'}</h3>
      <button class="link-like" id="closeModal">Close</button>
    </div>
    <div style="padding-top:8px">
      <form id="authForm" style="display:grid;gap:10px">
        ${mode==='signup'?`<input name="name" placeholder="Full name" required style="padding:10px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)">` : ''}
        <input name="email" type="email" placeholder="Email" required style="padding:10px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)">
        <input name="password" type="password" placeholder="Password" minlength="6" required style="padding:10px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)">
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button class="ghost" type="button" id="switchAuth">${mode==='signup'?'Already have an account?':'Create account'}</button>
          <button class="btn">${mode==='signup'?'Sign up':'Sign in'}</button>
        </div>
      </form>
    </div>
  `;
  openModal();
  // event listeners
  document.getElementById('switchAuth').addEventListener('click', ()=>{
    closeModal();
    openAuth(mode==='signup'?'signin':'signup');
  });
  document.getElementById('authForm').addEventListener('submit', (e)=>{
    e.preventDefault();
    const fd = new FormData(e.target);
    const email = fd.get('email').toLowerCase();
    const password = fd.get('password');
    const name = fd.get('name') || '';
    if(mode==='signup'){
      const users = loadUsers();
      if(users.some(u=>u.email===email)){ flashMessage('Account already exists', true); return; }
      users.push({email, name, password: btoa(password)}); // NOTE: btoa used for demo only — not secure
      saveUsers(users); setSession({email,name}); flashMessage('Account created'); closeModal();
    } else {
      const users = loadUsers();
      const user = users.find(u=>u.email===email && u.password === btoa(password));
      if(!user){ flashMessage('Invalid credentials', true); return; }
      setSession({email:user.email,name:user.name}); flashMessage('Signed in'); closeModal();
    }
  });
}

/* update auth button based on session */
function updateAuthUI(){
  const session = getSession();
  const authBtn = document.getElementById('authBtn');
  if(session){
    authBtn.textContent = session.name ? `Hi, ${shortName(session.name)}` : `Hi`;
    authBtn.classList.add('ghost');
    authBtn.title = 'Open account menu';
    authBtn.onclick = ()=> openAccountMenu();
  } else {
    authBtn.textContent = 'Sign in';
    authBtn.onclick = ()=> openAuth('signin');
  }
}
function openAccountMenu(){
  const content = document.getElementById('modalContent');
  const user = getSession();
  content.innerHTML = `
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3>Account</h3><button class="link-like" id="closeModal">Close</button>
    </div>
    <div style="padding:12px 0">
      <div style="font-weight:800">${escapeHtml(user.name || user.email)}</div>
      <div class="muted" style="margin-top:6px">${escapeHtml(user.email)}</div>
      <div style="margin-top:12px;display:flex;gap:8px">
        <button class="btn" id="signOut">Sign out</button>
        <button class="ghost" id="viewOrders">Orders (demo)</button>
      </div>
    </div>
  `;
  openModal();
  document.getElementById('signOut').addEventListener('click', ()=>{
    clearSession(); flashMessage('Signed out'); closeModal();
  });
}

/* ----- small utils ----- */
function shortName(n){ return n.split(' ').slice(0,1)[0] }
function flashMessage(msg, isError=false){
  const el = document.createElement('div');
  el.textContent = msg;
  el.style.position='fixed';el.style.right='18px';el.style.bottom='18px';el.style.padding='10px 14px';el.style.borderRadius='10px';
  el.style.background = isError? 'linear-gradient(90deg,#ff6b6b,#ff9671)': 'linear-gradient(90deg,#4ade80,#16a34a)';
  el.style.color='white';el.style.boxShadow='0 10px 30px rgba(2,6,23,0.2)';el.style.zIndex=120;document.body.appendChild(el);
  setTimeout(()=> el.style.opacity='0',2200); setTimeout(()=>el.remove(),3000);
}

/* ----- IntersectionObserver for reveal animations ----- */
let io;
function observeCards(){
  const cards = document.querySelectorAll('.book-card');
  if('IntersectionObserver' in window){
    if(io) cards.forEach(c=>io.observe(c));
    else {
      io = new IntersectionObserver((entries)=>{
        entries.forEach(ent=>{
          if(ent.isIntersecting) ent.target.classList.add('in-view');
        });
      }, {threshold:0.12});
      cards.forEach(c=>io.observe(c));
    }
  } else {
    // fallback
    cards.forEach(c=>c.classList.add('in-view'));
  }
}

/* ----- theme toggle and persistence ----- */
const themeToggle = document.getElementById('themeToggle');
const root = document.documentElement;
function readTheme(){
  const t = localStorage.getItem('ww_theme');
  if(t) root.setAttribute('data-theme', t);
  updateThemeLabel();
}
function updateThemeLabel(){
  const label = document.getElementById('themeLabel');
  const t = root.getAttribute('data-theme') || 'light';
  document.getElementById('themeToggle').setAttribute('aria-pressed', t==='dark');
  label.textContent = t==='dark' ? 'Dark' : 'Light';
  document.getElementById('themeToggle').title = t==='dark' ? 'Switch to light' : 'Switch to dark';
}
themeToggle.addEventListener('click', ()=>{
  const cur = root.getAttribute('data-theme') || 'light';
  const next = cur==='dark' ? 'light' : 'dark';
  root.setAttribute('data-theme', next);
  localStorage.setItem('ww_theme', next);
  updateThemeLabel();
});
readTheme();

/* ----- contact form demo ----- */
document.getElementById('contactForm').addEventListener('submit', (e)=>{
  e.preventDefault();
  flashMessage('Thanks — message sent (demo)');
  e.target.reset();
});

/* ----- modal close binding (close buttons inserted dynamically) ----- */
document.addEventListener('click', (e)=>{
  if(e.target && e.target.id === 'closeModal') closeModal();
});

/* ----- small helpers for safe init ----- */
function init(){
  renderBooks(books);
  updateCartUI();
  updateAuthUI();
  // attach event to addFromDetails maybe later
}
init();

/* ----- keyboard: escape to close modal ----- */
document.addEventListener('keydown', (e)=>{
  if(e.key === 'Escape') closeModal();
});

/* ----- document click: handle sign out from dynamic buttons (delegated) ----- */
/* Already handled inside modal content event listeners */

/* ----- utility: basic html escaping in templates already used above ----- */

/* ----- observe when DOM ready (already) ----- */

</script>

</body>
</html>
